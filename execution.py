import subprocess
import time
import re

def runCmd(cmd):
    process = subprocess.Popen([cmd],stdout=subprocess.PIPE)
    stdout, stderr = process.communicate()
    return [stdout,stderr]


def runNetDiscover(cmd,timeout=5):
    start_time = time.time()
    process = subprocess.Popen(cmd,stdout=subprocess.PIPE)
    output = set([])
    pattern = re.compile(r'(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})')
    while True:
        print("Scanning the network, please wait...")
        
        line = process.stdout.readline()
        if not line:
            break
        elapsed = time.time() - start_time
        line = line.replace("\n","")
        if(line.find("scanning") == -1):
            if pattern.search(line):
                ip = pattern.search(line).group(0)
                output.add(ip)
            
            
        if elapsed > timeout:
            process.terminate()
            return output