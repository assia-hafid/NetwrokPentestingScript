from execution import runCmd,runNetDiscover
import re

def networkScanMenu():

    print("1- Scan the entire network")
    print("2- scan by range")
    print("3- scan by timeout")
    print("0- exit")

def networkScan():
    networkScanMenu()
    choice = int(input("Please choose your option: "))
    if(choice == 0):
        return 
    while(choice<1 or choice >5):
        print("Your choice is invalid, please enter a valid one")
        networkScanMenu()
    
    while choice != 0:
        if(choice == 1):
            fullNetworkScan()
            print("\nThe scan has finished!")
        elif(choice == 2):
            rangeNetworkScan()
        
        networkScanMenu()
        choice = int(input("Please choose your option: "))
        

def fullNetworkScan():

    output = runNetDiscover(["netdiscover"])
    arr = list(output)
    if len(arr) > 0:
        print("\nWe found those IPs for you! you can use then in other options !\n")
        for ip in arr:
            print(ip)
    else:
        print("\nSorry we couldn't find any IP, please try again...\n")
    
    #this function needs more improvments

def rangeNetworkScan():

    pattern = re.compile(r'(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})')

    print("Please choose a range (/16 or /24)")
    print("1- /16")
    print("2- /24")
    rgVals = ["/16","/24"]
    rg = int(input("your choice: "))
    while rg!= 1 and rg!=2:
        print("Please choose between 1 and 2")
        rg = int(input("your choice: "))
    print("Please enter your gateway")
    gateway = raw_input("Gateway: ")
    if pattern.search(gateway) != None:
        output = runNetDiscover(["netdiscover","-r",gateway+"/"+rgVals[rg-1]])
        arr = list(output)
        if len(arr) > 0:
            print("\nWe found those IPs for you! you can use then in other options !\n")
            for ip in arr:
                print(ip)
            print("\n")
        else:
            print("\nSorry we couldn't find any IP, please try again...\n")
    else:
        print("Invalide Gateway")



# 192.168.0.0
# 192.168.1.117

# 16
# 192.168.x.x -> 192.168.0.1, 192.168.0.2 -> 192.168.0.255 -> 192.168.1.0 -> 192.168.255.255
